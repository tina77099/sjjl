<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·ç™»å½• - äº‹ä»¶è®°å½•</title>
    <!-- é˜²ç¼“å­˜æ ‡ç­¾ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex items-center justify-center">
    <div class="max-w-md w-full mx-4">
        <!-- è¿”å›é¦–é¡µé“¾æ¥ -->
        <div class="text-center mb-6">
            <a href="../index.html" class="text-indigo-600 hover:text-indigo-800 inline-flex items-center">
                <i class="fas fa-arrow-left mr-2"></i>è¿”å›é¦–é¡µ
            </a>
        </div>
        
        <!-- ç™»å½•å¡ç‰‡ -->
        <div class="bg-white rounded-lg shadow-xl p-8">
            <div class="text-center mb-8">
                <div class="mx-auto h-12 w-12 bg-indigo-100 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-sign-in-alt text-indigo-600 text-xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900">ç™»å½•è´¦æˆ·</h2>
                <p class="text-gray-600 mt-2">æ¬¢è¿å›åˆ°äº‹ä»¶è®°å½•</p>
            </div>

            <!-- ç™»å½•è¡¨å• -->
            <form id="login-form" class="space-y-6">
                <!-- ç”¨æˆ·åè¾“å…¥ï¼ˆæ‰‹æœºå·æˆ–é‚®ç®±ï¼‰ -->
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-2">æ‰‹æœºå·æˆ–é‚®ç®±</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-user text-gray-400"></i>
                        </div>
                        <input type="text" id="username" name="username" required
                               class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="è¯·è¾“å…¥æ‰‹æœºå·æˆ–é‚®ç®±">
                    </div>
                    <p id="username-error" class="text-red-500 text-sm mt-1 hidden"></p>
                </div>

                <!-- å¯†ç è¾“å…¥ -->
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">å¯†ç </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-lock text-gray-400"></i>
                        </div>
                        <input type="password" id="password" name="password" required
                               class="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                               placeholder="è¯·è¾“å…¥å¯†ç ">
                        <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                            <i class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                        </button>
                    </div>
                    <p id="password-error" class="text-red-500 text-sm mt-1 hidden"></p>
                </div>

                <!-- è®°ä½ç™»å½•å’Œå¿˜è®°å¯†ç  -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input type="checkbox" id="remember-me" name="remember-me"
                               class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                        <label for="remember-me" class="ml-2 text-sm text-gray-600">è®°ä½æˆ‘</label>
                    </div>
                    <a href="forgot-password.html" class="text-sm text-indigo-600 hover:text-indigo-800">å¿˜è®°å¯†ç ï¼Ÿ</a>
                </div>

                <!-- ç™»å½•æŒ‰é’® -->
                <button type="submit" id="login-btn"
                        class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <span id="login-btn-text">ç™»å½•</span>
                    <i id="login-btn-loading" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                </button>
            </form>

            <!-- ç³»ç»Ÿé”™è¯¯æ—¶çš„é‡è¯•æŒ‰é’® -->
            <div id="retry-section" class="text-center" style="display: none;">
                <button id="retry-btn" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500">
                    <i class="fas fa-redo mr-2"></i>é‡æ–°åˆå§‹åŒ–
                </button>
            </div>

            <!-- é™„åŠ é€‰é¡¹ -->
            <div id="additional-options">
                <!-- æ³¨å†Œé“¾æ¥ -->
                <div class="mt-6 text-center">
                    <span class="text-gray-600">è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ</span>
                    <a href="register.html" class="text-indigo-600 hover:text-indigo-800 font-medium">ç«‹å³æ³¨å†Œ</a>
                </div>

                <!-- è°ƒè¯•å·¥å…·é“¾æ¥ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ -->
                <div class="mt-4 text-center">
                    <button id="debug-tool-btn" class="text-red-600 hover:text-red-800 text-xs font-medium underline" title="å¼€å‘è°ƒè¯•å·¥å…·">
                        ğŸ”§ è°ƒè¯•å¯†ç é—®é¢˜
                    </button>
                </div>
            </div>
        </div>

        <!-- çŠ¶æ€æç¤º -->
        <div id="status-message-container" class="mt-4 hidden">
            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                <div class="flex">
                    <i class="fas fa-check-circle text-green-400 mr-3 mt-0.5"></i>
                    <div class="text-sm text-green-800" id="status-text"></div>
                </div>
            </div>
        </div>

        <div id="error-message" class="mt-4 hidden">
            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <div class="flex">
                    <i class="fas fa-exclamation-circle text-red-400 mr-3 mt-0.5"></i>
                    <div class="text-sm text-red-800" id="error-text"></div>
                </div>
            </div>
        </div>

        <!-- ç™»å½•å¤±è´¥æ¬¡æ•°æç¤º -->
        <div id="lockout-message" class="mt-4 hidden">
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex">
                    <i class="fas fa-exclamation-triangle text-yellow-400 mr-3 mt-0.5"></i>
                    <div class="text-sm text-yellow-800" id="lockout-text"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/auth-system.js?v=20241223-2"></script>
    <script>
        // ç‰ˆæœ¬æ ‡è¯†
        console.log('ğŸ”§ ç™»å½•é¡µé¢ç‰ˆæœ¬: 3.0 - ç®€åŒ–åˆå§‹åŒ–æµç¨‹');

        // é¡µé¢åŠ è½½å®Œæˆåç›´æ¥åˆå§‹åŒ–ç™»å½•åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”„ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–ç™»å½•ç³»ç»Ÿ...');
            
            // ç›´æ¥åˆå§‹åŒ–ç™»å½•åŠŸèƒ½
            try {
                if (typeof window.AuthSystem !== 'undefined' && window.AuthSystem) {
                    console.log('âœ… AuthSystem å¯ç”¨ï¼Œå¼€å§‹åˆå§‹åŒ–ç™»å½•...');
                    window.AuthSystem.initLogin();
                    console.log('âœ… ç™»å½•åŠŸèƒ½åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    console.error('âŒ AuthSystem ä¸å¯ç”¨');
                    showError('è®¤è¯ç³»ç»ŸåŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
            } catch (error) {
                console.error('âŒ ç™»å½•åˆå§‹åŒ–å¤±è´¥:', error);
                showError('ç™»å½•ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼š' + error.message);
            }
            
            // ç»‘å®šè°ƒè¯•å·¥å…·æŒ‰é’®
            const debugBtn = document.getElementById('debug-tool-btn');
            if (debugBtn) {
                debugBtn.addEventListener('click', () => {
                    openDebugTool();
                });
            }
        });

        function showError(message) {
            const errorElement = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');
            
            if (errorElement && errorText) {
                errorText.textContent = message;
                errorElement.classList.remove('hidden');
            }
        }

        // ==================== è°ƒè¯•å·¥å…· ====================
        
        function openDebugTool() {
            console.log('ğŸ”§ æ‰“å¼€è°ƒè¯•å·¥å…·');
            
            if (typeof window.AuthSystem === 'undefined' || !window.AuthSystem) {
                alert('è®¤è¯ç³»ç»ŸæœªåŠ è½½ï¼Œæ— æ³•ä½¿ç”¨è°ƒè¯•å·¥å…·');
                return;
            }
            
            const email = prompt('è¯·è¾“å…¥è¦è°ƒè¯•çš„é‚®ç®±åœ°å€:');
            if (!email) return;
            
            const password = prompt('è¯·è¾“å…¥è¦æµ‹è¯•çš„å¯†ç :');
            if (!password) return;
            
            console.log('ğŸ§ª å¼€å§‹è°ƒè¯•...');
            
            // éªŒè¯ç”¨æˆ·æ•°æ®
            const validation = window.AuthSystem.validateUserData();
            console.log('ğŸ“Š æ•°æ®éªŒè¯ç»“æœ:', validation);
            
            // æµ‹è¯•å¯†ç 
            const passwordTest = window.AuthSystem.testPassword(email, password);
            console.log('ğŸ” å¯†ç æµ‹è¯•ç»“æœ:', passwordTest);
            
            // æ˜¾ç¤ºè°ƒè¯•ç»“æœ
            let debugResult = `ğŸ”§ è°ƒè¯•ç»“æœï¼š\n\n`;
            debugResult += `ğŸ“§ é‚®ç®±: ${email}\n`;
            debugResult += `ğŸ” å¯†ç é•¿åº¦: ${password.length}\n\n`;
            
            debugResult += `ğŸ“Š æ•°æ®éªŒè¯:\n`;
            debugResult += `âœ… æ•°æ®åº“æœ‰æ•ˆ: ${validation.valid}\n`;
            if (validation.users) {
                debugResult += `ğŸ‘¥ ç”¨æˆ·æ€»æ•°: ${validation.users.length}\n`;
            }
            if (validation.issues) {
                debugResult += `âš ï¸ é—®é¢˜: ${validation.issues.join(', ')}\n`;
            }
            
            debugResult += `\nğŸ” å¯†ç æµ‹è¯•:\n`;
            debugResult += `âœ… ç”¨æˆ·å­˜åœ¨: ${passwordTest.user_found || false}\n`;
            debugResult += `âœ… å¯†ç åŒ¹é…: ${passwordTest.password_matches || false}\n`;
            debugResult += `âœ… ç”¨æˆ·å·²éªŒè¯: ${passwordTest.user_verified || false}\n`;
            
            if (!passwordTest.success) {
                debugResult += `\nâŒ ç™»å½•å¤±è´¥åŸå› :\n`;
                if (!passwordTest.user_found) {
                    debugResult += `â€¢ ç”¨æˆ·ä¸å­˜åœ¨\n`;
                } else if (!passwordTest.password_matches) {
                    debugResult += `â€¢ å¯†ç ä¸åŒ¹é…\n`;
                } else if (!passwordTest.user_verified) {
                    debugResult += `â€¢ ç”¨æˆ·æœªéªŒè¯\n`;
                }
            }
            
            debugResult += `\nğŸ”§ å»ºè®®è§£å†³æ–¹æ¡ˆ:\n`;
            if (!passwordTest.user_found) {
                debugResult += `â€¢ è¯·æ£€æŸ¥é‚®ç®±æ˜¯å¦æ­£ç¡®\n`;
                debugResult += `â€¢ ç¡®è®¤æ˜¯å¦å·²å®Œæˆæ³¨å†Œ\n`;
            } else if (!passwordTest.password_matches) {
                debugResult += `â€¢ å°è¯•é‡æ–°é‡ç½®å¯†ç \n`;
                debugResult += `â€¢ æ£€æŸ¥å¯†ç æ˜¯å¦è¾“å…¥é”™è¯¯\n`;
            } else if (!passwordTest.user_verified) {
                debugResult += `â€¢ å®Œæˆé‚®ç®±éªŒè¯\n`;
            }
            
            alert(debugResult);
            
            // è¯¢é—®æ˜¯å¦è¦æ¸…ç†æ•°æ®
            if (confirm('æ˜¯å¦è¦æ¸…ç†æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼Ÿï¼ˆè¿™å°†åˆ é™¤æ‰€æœ‰æ³¨å†Œç”¨æˆ·ï¼‰')) {
                window.AuthSystem.resetUserData();
                alert('ç”¨æˆ·æ•°æ®å·²æ¸…ç†ï¼Œè¯·é‡æ–°æ³¨å†Œ');
            }
        }
    </script>
</body>
</html>
